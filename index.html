<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå - Sales Quotation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f3f4f6; }
        .input-group label { font-size: 0.875rem; color: #4b5563; margin-bottom: 0.25rem; display: block; }
        .input-box { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; outline: none; transition: border-color 0.2s; }
        .input-box:focus { border-color: #2563eb; ring: 2px; }
        .table-row-custom:nth-child(even) { background-color: #f9fafb; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit no-print">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h2>
            
            <div class="space-y-4">
                <div class="input-group">
                    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ</label>
                    <select id="carModel" class="input-box bg-gray-50" onchange="updatePrice()">
                        <option value="0">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ --</option>
                        <option value="679000">City Turbo : SV (679,000)</option>
                        <option value="749000">City Turbo : RS (749,000)</option>
                        <option value="599000">City HB Turbo : S+ (599,000)</option>
                        <option value="679000">City HB Turbo : SV (679,000)</option>
                        <option value="749000">City HB Turbo : RS (749,000)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div class="input-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="carPrice" class="input-box" value="0" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="colorPrice" class="input-box" value="0" oninput="calculate()">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div class="input-group">
                        <label>‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå (%)</label>
                        <input type="number" id="downPercent" class="input-box" value="25" oninput="updateDownAmount()">
                    </div>
                    <div class="input-group">
                        <label>‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="downAmount" class="input-box" value="0" oninput="updateDownPercent()">
                    </div>
                </div>

                <div class="input-group">
                    <label>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ (‡∏ã‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå)</label>
                    <input type="number" id="discount" class="input-box text-red-600" value="0" oninput="calculate()">
                </div>

                <hr>

                <h3 class="font-semibold text-sm text-gray-600">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ (%)</h3>
                <div class="grid grid-cols-4 gap-2">
                    <div class="input-group">
                        <label>48 ‡∏á‡∏ß‡∏î</label>
                        <input type="number" id="rate48" class="input-box" value="2.09" step="0.01" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>60 ‡∏á‡∏ß‡∏î</label>
                        <input type="number" id="rate60" class="input-box" value="2.34" step="0.01" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>72 ‡∏á‡∏ß‡∏î</label>
                        <input type="number" id="rate72" class="input-box" value="2.74" step="0.01" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>84 ‡∏á‡∏ß‡∏î</label>
                        <input type="number" id="rate84" class="input-box" value="3.30" step="0.01" oninput="calculate()">
                    </div>
                </div>

                <hr>

                <h3 class="font-semibold text-sm text-gray-600">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ</h3>
                <div class="grid grid-cols-2 gap-2">
                    <div class="input-group">
                        <label>‡∏Ñ‡πà‡∏≤‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
                        <input type="number" id="regFee" class="input-box" value="3500" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏î‡∏á</label>
                        <input type="number" id="redPlate" class="input-box" value="3000" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>‡∏´‡∏±‡∏Å‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏≠‡∏á</label>
                        <input type="number" id="bookingDeduct" class="input-box" value="5000" oninput="calculate()">
                    </div>
                    <div class="input-group">
                        <label>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢</label>
                        <input type="number" id="insurance" class="input-box" value="0" oninput="calculate()">
                    </div>
                </div>
                
                <div class="input-group mt-2">
                    <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏° (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ comma ,)</label>
                    <textarea id="giftList" class="input-box h-24" oninput="renderGifts()">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢‡∏ä‡∏±‡πâ‡∏ô 1, ‡∏ü‡∏¥‡∏•‡πå‡∏°‡πÄ‡∏ã‡∏£‡∏≤‡∏°‡∏¥‡∏Å, ‡∏û‡∏£‡∏°‡∏õ‡∏π‡∏û‡∏∑‡πâ‡∏ô, ‡∏Å‡∏£‡∏≠‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô, ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ñ‡∏±‡∏á, Ultimate Care</textarea>
                </div>

                <button onclick="saveImage()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg mt-4 shadow transition">
                    üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡πà‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                </button>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div id="quotation-card" class="bg-white p-8 rounded-xl shadow-lg border border-gray-200 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-indigo-600"></div>

                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</h1>
                        <p class="text-gray-500 text-sm mt-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="currentDate"></span></p>
                    </div>
                    <div class="text-right">
                        <h2 class="text-xl font-bold text-blue-600">HONDA DEALER</h2>
                        <p class="text-sm text-gray-500">‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢: <span contenteditable="true" class="border-b border-gray-300 focus:outline-none focus:border-blue-500">‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span></p>
                        <p class="text-sm text-gray-500">Tel/Line: <span contenteditable="true" class="border-b border-gray-300 focus:outline-none focus:border-blue-500">08x-xxx-xxxx</span></p>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500">‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</p>
                            <p class="font-bold text-lg text-gray-800" id="dispModel">City Turbo</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏£‡∏ß‡∏°‡∏™‡∏µ (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)</p>
                            <p class="font-bold text-2xl text-blue-700" id="dispNetPrice">0 ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="font-bold text-gray-700 mb-3 border-l-4 border-blue-500 pl-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î</h3>
                        
                        <div class="flex justify-between mb-2 text-sm">
                            <span>‡∏¢‡∏≠‡∏î‡∏à‡∏±‡∏î‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå:</span>
                            <span class="font-bold" id="dispFinance">0</span>
                        </div>
                        <div class="flex justify-between mb-4 text-sm">
                            <span>‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå (<span id="dispDownPercent">0</span>%):</span>
                            <span class="font-bold text-green-600" id="dispDownAmount">0</span>
                        </div>

                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600">
                                    <th class="py-2 px-2 text-left">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏ß‡∏î</th>
                                    <th class="py-2 px-2 text-center">‡∏î‡∏ö.</th>
                                    <th class="py-2 px-2 text-right">‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                <tr class="table-row-custom">
                                    <td class="py-2 px-2">48 ‡∏á‡∏ß‡∏î (4 ‡∏õ‡∏µ)</td>
                                    <td class="py-2 px-2 text-center" id="dispRate48">-</td>
                                    <td class="py-2 px-2 text-right font-bold text-gray-800" id="inst48">0</td>
                                </tr>
                                <tr class="table-row-custom">
                                    <td class="py-2 px-2">60 ‡∏á‡∏ß‡∏î (5 ‡∏õ‡∏µ)</td>
                                    <td class="py-2 px-2 text-center" id="dispRate60">-</td>
                                    <td class="py-2 px-2 text-right font-bold text-gray-800" id="inst60">0</td>
                                </tr>
                                <tr class="table-row-custom">
                                    <td class="py-2 px-2">72 ‡∏á‡∏ß‡∏î (6 ‡∏õ‡∏µ)</td>
                                    <td class="py-2 px-2 text-center" id="dispRate72">-</td>
                                    <td class="py-2 px-2 text-right font-bold text-gray-800" id="inst72">0</td>
                                </tr>
                                <tr class="table-row-custom">
                                    <td class="py-2 px-2">84 ‡∏á‡∏ß‡∏î (7 ‡∏õ‡∏µ)</td>
                                    <td class="py-2 px-2 text-center" id="dispRate84">-</td>
                                    <td class="py-2 px-2 text-right font-bold text-gray-800" id="inst84">0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div>
                        <h3 class="font-bold text-gray-700 mb-3 border-l-4 border-orange-500 pl-2">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå</span>
                                <span id="sumDown">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏î‡∏á (‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô)</span>
                                <span id="sumRedPlate">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏Ñ‡πà‡∏≤‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</span>
                                <span id="sumReg">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢</span>
                                <span id="sumInsure">0</span>
                            </div>
                            <div class="flex justify-between text-red-500">
                                <span>‡∏´‡∏±‡∏Å ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏à‡∏≠‡∏á</span>
                                <span id="sumBooking">- 0</span>
                            </div>
                            <div class="border-t pt-2 mt-2">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-gray-800">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏ñ</span>
                                    <span class="font-bold text-2xl text-orange-600" id="grandTotal">0</span>
                                </div>
                                <p class="text-xs text-gray-400 text-right mt-1">*‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</p>
                            </div>
                        </div>

                        <div class="mt-6">
                            <h3 class="font-bold text-gray-700 mb-2 border-l-4 border-green-500 pl-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°</h3>
                            <ul id="displayGiftList" class="text-xs text-gray-600 list-disc pl-4 grid grid-cols-2 gap-x-2 gap-y-1">
                                </ul>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-4 border-t text-center text-xs text-gray-400">
                    <p>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set Current Date
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('th-TH', dateOptions);

        // Format Number helper
        const fmt = (num) => {
            return parseFloat(num).toLocaleString('th-TH', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        // 1. Update Base Price from Select
        function updatePrice() {
            const select = document.getElementById('carModel');
            const price = select.value;
            const text = select.options[select.selectedIndex].text;
            
            document.getElementById('carPrice').value = price;
            // Update Display Model Name
            document.getElementById('dispModel').innerText = text.split('(')[0];
            calculate();
        }

        // 2. Sync Down Payment (Percent <-> Amount)
        function updateDownAmount() {
            const price = parseFloat(document.getElementById('carPrice').value) || 0;
            const colorPrice = parseFloat(document.getElementById('colorPrice').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            
            // Base Calculation Price for Finance usually includes color but excludes discount for down payment calculation base
            // But usually Down % is calculated on (Car Price + Color)
            const basePrice = price + colorPrice;
            
            const percent = parseFloat(document.getElementById('downPercent').value) || 0;
            const amount = basePrice * (percent / 100);
            
            document.getElementById('downAmount').value = amount.toFixed(0);
            calculate(false); // false means don't recalc down amount again
        }

        function updateDownPercent() {
            const price = parseFloat(document.getElementById('carPrice').value) || 0;
            const colorPrice = parseFloat(document.getElementById('colorPrice').value) || 0;
            const basePrice = price + colorPrice;
            const amount = parseFloat(document.getElementById('downAmount').value) || 0;

            if(basePrice > 0) {
                const percent = (amount / basePrice) * 100;
                document.getElementById('downPercent').value = percent.toFixed(2);
            }
            calculate(false);
        }

        // 3. Main Calculation Logic
        function calculate(recalcDown = true) {
            // Get Inputs
            const carPrice = parseFloat(document.getElementById('carPrice').value) || 0;
            const colorPrice = parseFloat(document.getElementById('colorPrice').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0; // Sub-down
            
            const totalPrice = carPrice + colorPrice;
            const netPrice = totalPrice - discount; // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡πÉ‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå ‡πÅ‡∏ï‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ó‡∏≥‡∏ï‡∏≤‡∏° logic ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏¢‡∏≠‡∏î‡∏à‡∏±‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô)

            // Re-sync down amount if needed (e.g. if price changed)
            if (recalcDown) {
                 const percent = parseFloat(document.getElementById('downPercent').value) || 0;
                 const downAmount = totalPrice * (percent / 100);
                 document.getElementById('downAmount').value = downAmount.toFixed(0);
            }

            const downAmount = parseFloat(document.getElementById('downAmount').value) || 0;
            const financeAmount = totalPrice - downAmount - discount; // ‡∏¢‡∏≠‡∏î‡∏à‡∏±‡∏î = ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ñ + ‡∏™‡∏µ - ‡∏î‡∏≤‡∏ß‡∏ô‡πå - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î(‡∏ã‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå)

            // Update UI: Prices
            document.getElementById('dispNetPrice').innerText = fmt(totalPrice) + " ‡∏ö‡∏≤‡∏ó"; // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° + ‡∏™‡∏µ
            document.getElementById('dispFinance').innerText = fmt(financeAmount) + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById('dispDownAmount').innerText = fmt(downAmount) + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById('dispDownPercent').innerText = document.getElementById('downPercent').value;

            // Calculate Installments
            const terms = [48, 60, 72, 84];
            terms.forEach(term => {
                const rateId = 'rate' + term;
                const rate = parseFloat(document.getElementById(rateId).value) || 0;
                
                // Update Display Rate
                document.getElementById('dispRate' + term).innerText = rate.toFixed(2) + '%';

                // Formula: (Finance * Rate * Year) + Finance / Months
                const years = term / 12;
                const totalInterest = financeAmount * (rate / 100) * years;
                const totalLoan = financeAmount + totalInterest;
                const monthly = totalLoan / term;

                document.getElementById('inst' + term).innerText = fmt(monthly);
            });

            // Calculate Pickup Day Cost
            const regFee = parseFloat(document.getElementById('regFee').value) || 0;
            const redPlate = parseFloat(document.getElementById('redPlate').value) || 0;
            const booking = parseFloat(document.getElementById('bookingDeduct').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;

            document.getElementById('sumDown').innerText = fmt(downAmount);
            document.getElementById('sumRedPlate').innerText = fmt(redPlate);
            document.getElementById('sumReg').innerText = fmt(regFee);
            document.getElementById('sumInsure').innerText = fmt(insurance);
            document.getElementById('sumBooking').innerText = "- " + fmt(booking);

            const pickupTotal = downAmount + regFee + redPlate + insurance - booking;
            document.getElementById('grandTotal').innerText = fmt(pickupTotal) + " ‡∏ö‡∏≤‡∏ó";

            renderGifts();
        }

        // 4. Render Gifts
        function renderGifts() {
            const raw = document.getElementById('giftList').value;
            const items = raw.split(',').map(s => s.trim()).filter(s => s !== '');
            
            const listContainer = document.getElementById('displayGiftList');
            listContainer.innerHTML = '';
            
            items.forEach(item => {
                const li = document.createElement('li');
                li.innerText = item;
                listContainer.appendChild(li);
            });
        }

        // 5. Save Image Function
        function saveImage() {
            const node = document.getElementById('quotation-card');
            
            html2canvas(node, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = '‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤-' + new Date().getTime() + '.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // Initialize
        calculate();
        renderGifts();

    </script>
</body>
</html>
